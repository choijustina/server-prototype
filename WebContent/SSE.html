<!DOCTYPE html>
<html>

<head>
<style>
body {
	overflow-x: hidden;
	word-wrap: break-word;
	background: pink;
}

</style>	
<script type="text/javascript">
// GLOBAL VARIABLES FOR LATER //////////////////////////////////////
var loanNum = "blank";
var docType = "blank";

function pageScroll() {
	//negative for scrolling up, positive for scrolling down
	window.scrollBy(0,-100);
	scrolldelay = setTimeout('pageScroll()',50);
}

function addLoadEvent(func) {
  var oldonload = window.onload;
  if (typeof window.onload != 'function') {
    window.onload = func;
  } else {
    window.onload = function() {
      if (oldonload) {
        oldonload();
      }
      func();
    }
  }
}

function parseQueryString() {
	loanNum = window.parent.QueryString.loannum;
	docType = window.parent.QueryString.doctype;
	//alert("loanNum: " + loanNum + ", docType: " + docType);
}

addLoadEvent(pageScroll());
addLoadEvent(parseQueryString());

</script>
</head>

<body>

<div id="ServerTime"></div>

<script>
if (typeof (EventSource) != "undefined") {
	var source = new EventSource("http://localhost:8080/SSE/RoutingConsumer");
	
	source.onopen = function(event) {
		document.body.innerHTML = "Connection was opened" + "<br>" + document.body.innerHTML;
	}
	source.onerror = function(event) {
		document.body.innerHTML = "An error occurred; auto-reconnecting" + "<br>" + document.body.innerHTML;
	}
	
	source.addEventListener('clear', function(e) {
		document.body.innerHTML = "[*] Waiting for messages.." + "<br>";
		//document.body.innerHTML = "[*] Waiting for messages.." + "<br>" + e.data;
	}, false);
	
	source.addEventListener('jsonobject', function(e) {
		var info = JSON.parse(e.data);
		
		//assumes has id, msgtype, name, doctype, data
		var print = "ID: " + info.id + "<br>" +
		"MSGTYPE: " + info.msgtype + "<br>" +
		"NAME: " + info.name + "<br>" + 
		"DOCTYPE: " + info.doctype + "<br>" +
		"DATA: " + info.data + "<br><br>";
		/*
		//print name
		if (SSEsearch == info.name) {
			document.body.innerHTML = "matching name: " + info.name + "<br>" + print + document.body.innerHTML;
		}
		else {
			document.body.innerHTML = "not a match<br><br>" + document.body.innerHTML;
		}*/
		
		document.body.innerHTML = print + document.body.innerHTML;
		
	}, false);
	
	// onmessage handler is used if no event name is specified for a message
	source.onmessage = function(event) {
		document.body.innerHTML = event.data + "<br>" + document.body.innerHTML;
	}
	
} else {
	document.body.innerHTML = "Sorry, your browser does not support server-sent events...";
}

</script>

</body>
</html>